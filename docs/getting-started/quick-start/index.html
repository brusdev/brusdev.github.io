<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=/themify-icons/themify-icons.css><link rel=stylesheet href=/main.b384936c51c415221a6affb1c729345824dfe7eae28c8bb9e875151c662a829b83dde28f7e2120d7bd005f319a15de230002b0020dc089ba94184f0014dcd819.css integrity="sha512-s4STbFHEFSIaav+xxyk0WCTf5+rijIu56HUVHGYqgpuD3eKPfiEg170AXzGaFd4jAAKwAg3AibqUGE8AFNzYGQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Quick Start - ArtemisCloud.io</title><meta name=description content="One page summary of how to start a new Doks project."><link rel=canonical href=/docs/getting-started/quick-start/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Quick Start"><meta property="og:description" content="One page summary of how to start a new Doks project."><meta property="og:url" content="/docs/getting-started/quick-start/"><meta property="og:site_name" content="ArtemisCloud.io"><meta property="article:published_time" content="2020-11-16T13:59:39+01:00"><meta property="article:modified_time" content="2020-11-16T13:59:39+01:00"><meta property="og:image" content="/artemiscloud.png"><meta property="og:image:alt" content="ArtemisCloud.io"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@artemiscloudio"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Quick Start"><meta name=twitter:description content="One page summary of how to start a new Doks project."><meta name=twitter:image content="/artemiscloud.png"><meta name=twitter:image:alt content="Quick Start"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"/#/schema/organization/1","name":"ArtemisCloud.io","url":"/","sameAs":["https://twitter.com/artemiscloudio","https://github.com/artemiscloud"],"logo":{"@type":"ImageObject","@id":"/#/schema/image/1","url":"/artemiscloud.png","width":512,"height":512,"caption":"ArtemisCloud.io"},"image":{"@id":"/#/schema/image/1"}},{"@type":"WebSite","@id":"/#/schema/website/1","url":"/","name":"ArtemisCloud.io","description":"ArtemisCloud.io is a collection of container images that provide a way to deploy the Apache ActiveMQ Artemis Broker on Kubernetes.","publisher":{"@id":"/#/schema/organization/1"}},{"@type":"WebPage","@id":"/docs/getting-started/quick-start/","url":"/docs/getting-started/quick-start/","name":"Quick Start","description":"One page summary of how to start a new Doks project.","isPartOf":{"@id":"/#/schema/website/1"},"about":{"@id":"/#/schema/organization/1"},"datePublished":"2020-11-16T13:59:39CET","dateModified":"2020-11-16T13:59:39CET","breadcrumb":{"@id":"/docs/getting-started/quick-start/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"/docs/getting-started/quick-start/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["/docs/getting-started/quick-start/"]}]},{"@type":"BreadcrumbList","@id":"/docs/getting-started/quick-start/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"/","url":"/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"/docsgetting-startedquick-start/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"/#/schema/article/1","headline":"Quick Start","description":"One page summary of how to start a new Doks project.","isPartOf":{"@id":"/docs/getting-started/quick-start/"},"mainEntityOfPage":{"@id":"/docs/getting-started/quick-start/"},"datePublished":"2020-11-16T13:59:39CET","dateModified":"2020-11-16T13:59:39CET","author":{"@id":"/#/schema/person/2"},"publisher":{"@id":"/#/schema/organization/1"},"image":{"@id":"/docs/getting-started/quick-start/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"/#/schema/person/2","name":null,"sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"/docs/getting-started/quick-start/#/schema/image/2","url":"/artemiscloud.png","contentUrl":"/artemiscloud.png","caption":"Quick Start"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=/site.webmanifest></head><body class="docs single"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-fluid flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label=ArtemisCloud.io>ArtemisCloud.io</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>ArtemisCloud.io</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/docs/getting-started/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/blog/>Blog</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle ps-0 py-1" href=# id=navbarDropdownMenuLink role=button data-bs-toggle=dropdown aria-expanded=false>Get Started
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></a><ul class="dropdown-menu dropdown-menu-main shadow rounded border-0" aria-labelledby=navbarDropdownMenuLink><li><a class="dropdown-item active" href=/docs/getting-started/quick-start/ aria-current=true>Quick Start</a></li><li><a class=dropdown-item href=/docs/tutorials/using_operator/>Tutorial</a></li></ul></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/artemiscloud><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://twitter.com/artemiscloudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><small class="ms-2 d-md-none">Twitter</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-fluid d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-fluid><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cb59b87e00d11222bfd9159d0d23836f aria-expanded=true>
Getting started</button><div class="collapse show" id=section-cb59b87e00d11222bfd9159d0d23836f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/getting-started/introduction/>Introduction</a></li><li><a class="docs-link rounded active" href=/docs/getting-started/quick-start/>Quick Start</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a26f548831e6a8c26bfbbd9f6ec61e0 aria-expanded=false>
Help</button><div class=collapse id=section-6a26f548831e6a8c26bfbbd9f6ec61e0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/help/building/>Building</a></li><li><a class="docs-link rounded" href=/docs/help/bundle/>Bundle</a></li><li><a class="docs-link rounded" href=/docs/help/custom-resources/>Custom Resources</a></li><li><a class="docs-link rounded" href=/docs/help/images-copy/>Images</a></li><li><a class="docs-link rounded" href=/docs/help/operator/>Operator</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-130ddfce9c28453883ccfe2da8b6d5ac aria-expanded=false>
Tutorials</button><div class=collapse id=section-130ddfce9c28453883ccfe2da8b6d5ac><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/tutorials/deploybasicimage/>Deploying the Basic Broker Image</a></li><li><a class="docs-link rounded" href=/docs/tutorials/using_operator/>Getting Started with the ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/scaleup_and_scaledown/>Scaling Up and Down Brokers with ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/ssl_broker_setup/>Setting up SSL connections with ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/initcontainer/>Using the custom init image</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-fluid" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-cb59b87e00d11222bfd9159d0d23836f aria-expanded=true>
Getting started</button><div class="collapse show" id=section-cb59b87e00d11222bfd9159d0d23836f><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/getting-started/introduction/>Introduction</a></li><li><a class="docs-link rounded active" href=/docs/getting-started/quick-start/>Quick Start</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-6a26f548831e6a8c26bfbbd9f6ec61e0 aria-expanded=false>
Help</button><div class=collapse id=section-6a26f548831e6a8c26bfbbd9f6ec61e0><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/help/building/>Building</a></li><li><a class="docs-link rounded" href=/docs/help/bundle/>Bundle</a></li><li><a class="docs-link rounded" href=/docs/help/custom-resources/>Custom Resources</a></li><li><a class="docs-link rounded" href=/docs/help/images-copy/>Images</a></li><li><a class="docs-link rounded" href=/docs/help/operator/>Operator</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-130ddfce9c28453883ccfe2da8b6d5ac aria-expanded=false>
Tutorials</button><div class=collapse id=section-130ddfce9c28453883ccfe2da8b6d5ac><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/tutorials/deploybasicimage/>Deploying the Basic Broker Image</a></li><li><a class="docs-link rounded" href=/docs/tutorials/using_operator/>Getting Started with the ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/scaleup_and_scaledown/>Scaling Up and Down Brokers with ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/ssl_broker_setup/>Setting up SSL connections with ArtemisCloud Operator</a></li><li><a class="docs-link rounded" href=/docs/tutorials/initcontainer/>Using the custom init image</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#general-environment-requirements>General environment requirements</a></li><li><a href=#getting-the-code-and-build-the-image>Getting the code and build the image</a></li><li><a href=#deploying-the-operator>Deploying the operator</a></li><li><a href=#deploying-the-broker>Deploying the broker</a></li><li><a href=#scaling>Scaling</a><ul><li><a href=#clustering>Clustering</a></li></ul></li><li><a href=#undeploying-the-broker>Undeploying the broker</a></li><li><a href=#managing-queues>Managing Queues</a><ul><li><a href=#overview-1>Overview</a></li></ul></li><li><a href=#draining-messages-on-scale-down>Draining messages on scale down</a></li><li><a href=#undeploying-the-operator>Undeploying the operator</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl"><h1>Quick Start</h1><p class=lead>One page summary of how to start a new Doks project.</p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#general-environment-requirements>General environment requirements</a></li><li><a href=#getting-the-code-and-build-the-image>Getting the code and build the image</a></li><li><a href=#deploying-the-operator>Deploying the operator</a></li><li><a href=#deploying-the-broker>Deploying the broker</a></li><li><a href=#scaling>Scaling</a><ul><li><a href=#clustering>Clustering</a></li></ul></li><li><a href=#undeploying-the-broker>Undeploying the broker</a></li><li><a href=#managing-queues>Managing Queues</a><ul><li><a href=#overview-1>Overview</a></li></ul></li><li><a href=#draining-messages-on-scale-down>Draining messages on scale down</a></li><li><a href=#undeploying-the-operator>Undeploying the operator</a></li></ul></nav></div></nav><h1 id=overview>Overview <a href=#overview class=anchor aria-hidden=true>#</a></h1><p>At the moment these instructions have been tested against Kubernetes 1.20,
other kubernetes or OpenShift environments may require minor adjustment.</p><p>One important note about operators in general is that to get the operator
installed requires cluster-admin level privileges. Once installed, a regular
user should be able to install ActiveMQ Artemis via the provided custom
resource.</p><h1 id=quick-start>Quick Start <a href=#quick-start class=anchor aria-hidden=true>#</a></h1><h2 id=general-environment-requirements>General environment requirements <a href=#general-environment-requirements class=anchor aria-hidden=true>#</a></h2><p>Currently the operator is tested against kubernetes v1.20.
You can install a <a href=https://minikube.sigs.k8s.io/docs/>Minikube</a> or a <a href=https://developers.redhat.com/products/codeready-containers/overview>CodeReady Containers(CRC)</a> to deploy the operator.</p><h2 id=getting-the-code-and-build-the-image>Getting the code and build the image <a href=#getting-the-code-and-build-the-image class=anchor aria-hidden=true>#</a></h2><p>To launch the operator you will need to clone the <a href=https://github.com/artemiscloud/activemq-artemis-operator>activemq-artemis-operator</a> and checkout the main branch.</p><p>Follow the <a href=building.md>building</a> instructions, tag, and push it into your project
namespace.</p><h2 id=deploying-the-operator>Deploying the operator <a href=#deploying-the-operator class=anchor aria-hidden=true>#</a></h2><p>To deploy the operator simply run</p><pre><code class=language-$xslt>$ make deploy
</code></pre><p>or if you have built your own image, overrides the defaults</p><pre><code class=language-$xslt>make OPERATOR_IMAGE_REPO=&lt;your registry url&gt; OPERATOR_VERSION=&lt;your tag&gt; deploy
</code></pre><p>The defaults are specified in <a href=../Makefile>Makefile</a>.</p><p>The operator will be deployed into namespace <strong>activemq-artemis-operator</strong> and watches the same namespace.</p><p>To watch all namespace, change the <strong>WATCH_NAMESPACE</strong> environment variable defined in config/manager/manager.yaml to be empty string before deploy the operator.</p><p>At this point you should see the activemq-artemis-operator starting up and if you check the
logs you should see something like</p><pre><code class=language-$xslt>$ kubectl get pod -n activemq-artemis-operator
NAME                                                   READY   STATUS    RESTARTS   AGE
activemq-artemis-controller-manager-5ff459cd95-kn22m   1/1     Running   0          70m
</code></pre><h2 id=deploying-the-broker>Deploying the broker <a href=#deploying-the-broker class=anchor aria-hidden=true>#</a></h2><p>Now that the operator is running and listening for changes related to our crd we can deploy <a href=../examples/artemis-basic-deployment.yaml>one of our basic broker custom resource examples</a>
which looks like</p><pre><code class=language-$xslt>apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: ex-aao
spec:
  deploymentPlan:
    size: 1
    image: placeholder
</code></pre><p>Note in particular the <strong>spec.image</strong> which identifies the container image to use to launch the AMQ Broker. If it&rsquo;s empty or &lsquo;placeholder&rsquo; it will get the latest default image url from config/manager/manager.yaml where a list of supported broker image are defined as environment variables.</p><p>To deploy the broker simply execute</p><pre><code class=language-$xslt>kubectl create -f examples/artemis-basic-deployment.yaml -n activemq-artemis-operator
</code></pre><p>In a mement you should see one broker pod is created alongside the operator pod:</p><pre><code class=language-$xslt>$ kubectl get pod
NAME                                                   READY   STATUS    RESTARTS   AGE
activemq-artemis-controller-manager-5ff459cd95-kn22m   1/1     Running   0          128m
ex-aao-ss-0                                            1/1     Running   0          23m
</code></pre><h2 id=scaling>Scaling <a href=#scaling class=anchor aria-hidden=true>#</a></h2><p>The spec.deploymentPlan.size controls how many broker pods you want to deploy to the cluster. You can change this value and apply it to a running deployment to scale up and scale down the broker pods.</p><p>For example if you want to scale up the above deployment to 2 pods, modify the size to 2:</p><p>examples/artemis-basic-deployment.yaml</p><pre><code class=language-$xslt>apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: ex-aao
spec:
  deploymentPlan:
    size: 2
    image: placeholder
</code></pre><p>and apply it:</p><pre><code class=language-$xslt>kubectl apply -f examples/artemis-basic-deployment.yaml -n activemq-artemis-operator
</code></pre><p>and you will get 2 broker pods in the cluster</p><pre><code class=language-$xslt>kubectl get pod
NAME                                                   READY   STATUS    RESTARTS   AGE
activemq-artemis-controller-manager-5ff459cd95-kn22m   1/1     Running   0          140m
ex-aao-ss-0                                            1/1     Running   0          35m
ex-aao-ss-1                                            1/1     Running   0          69s
</code></pre><p>You can scale down the deployment in similar manner by reducing the size and apply it again.</p><h3 id=clustering>Clustering <a href=#clustering class=anchor aria-hidden=true>#</a></h3><p>By default if broker pods are scaled to more than one then the broker pods form a broker
<a href=https://activemq.apache.org/components/artemis/documentation/2.19.0/clusters.html>cluster</a>, meaning connect to each other and redistribute messages using default &lsquo;ON_DEMAND&rsquo; policy.</p><h2 id=undeploying-the-broker>Undeploying the broker <a href=#undeploying-the-broker class=anchor aria-hidden=true>#</a></h2><p>To undeploy the broker we simply execute</p><pre><code class=language-$xslt>$ kubectl delete -f examples/artemis-basic-deployment.yaml -n activemq-artemis-operator
activemqartemis.broker.amq.io &quot;ex-aao&quot; deleted
</code></pre><h2 id=managing-queues>Managing Queues <a href=#managing-queues class=anchor aria-hidden=true>#</a></h2><h3 id=overview-1>Overview <a href=#overview-1 class=anchor aria-hidden=true>#</a></h3><p>Users can use the activemqartemisaddress CRD to create and remove queues/address on a running broker pod.</p><p>For example suppose you have deployed a broker pod like above, you can deploy an activemqartemisaddress resouce from the <a href=../examples/address-queue-create-auto-removed.yaml>examples dir</a>:</p><p>address-queue-create-auto-removed.yaml:</p><pre><code class=language-$xslt>apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemisAddress
metadata:
  name: ex-aaoaddress
spec:
  addressName: myAddress0
  queueName: myQueue0
  routingType: anycast
  removeFromBrokerOnDelete: true
</code></pre><p>and the deploy command:</p><pre><code class=language-$xslt>$ kubectl create -f examples/address-queue-create-auto-removed.yaml -n activemq-artemis-operator
activemqartemisaddress.broker.amq.io/ex-aaoaddress created
</code></pre><p>When it is deployed it will create a queue named <strong>myQueue0</strong> on an address <strong>myAddress0</strong> with <strong>anycast</strong> routing type.</p><p>The <strong>spec.removeFromBrokerOnDelete</strong> controls how to deal with the created queue/address resources when you delete the above custom resource:</p><pre><code class=language-$xslt>$ kubectl delete -f examples/address-queue-create-auto-removed.yaml -n activemq-artemis-operator
activemqartemisaddress.broker.amq.io &quot;ex-aaoaddress&quot; deleted
</code></pre><p>If <strong>spec.removeFromBrokerOnDelete</strong> is true, the queue/address resources will be deleted from broker.
If it is false, the queue/address created by this custome resource will be kept in broker even after the custom resource has been deleted.</p><h2 id=draining-messages-on-scale-down>Draining messages on scale down <a href=#draining-messages-on-scale-down class=anchor aria-hidden=true>#</a></h2><p>When a broker pod is being scaled down, a scaledown controller can be deployed aumatically to handle message migration from the scaled down broker pod to an active broker.</p><p>When the scale down controller detects the event it starts a drainer pod.
The drainer pod will contact one of the live pods in the cluster and drain the messages over to it.
After the draining is complete it shuts down itself.</p><p>The message draining only works when you enabled persistence and messageMigration on broker custome resource.
For example create a broker.yaml with the following content:</p><pre><code class=language-$xslt>apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: ex-aao
spec:
  deploymentPlan:
    size: 2
    image: placeholder
    persistenceEnabled: true
    messageMigration: true
</code></pre><p>To demonstrate the message draining first deploy the above custom resource (assuming the operator is running):</p><pre><code class=language-$xslt>$ kubectl create -f broker.yaml -n activemq-artemis-operator
activemqartemis.broker.amq.io/ex-aao created
</code></pre><p>You shall see 2 broker pods are created.</p><pre><code class=language-$xslt>$ kubectl get pod
NAME                                                   READY   STATUS    RESTARTS   AGE
activemq-artemis-controller-manager-5ff459cd95-kn22m   1/1     Running   0          3h19m
ex-aao-ss-0                                            1/1     Running   0          89s
ex-aao-ss-1                                            1/1     Running   0          53s
</code></pre><p>Now we&rsquo;ll use broker&rsquo;s cli tool to send some messages to each broker pod.</p><p>First send 100 messages to broker <strong>ex-aao-ss-0</strong>:</p><pre><code class=language-$xslt>kubectl exec ex-aao-ss-0 -- amq-broker/bin/artemis producer --user x --password y --url tcp://ex-aao-ss-0:61616 --message-count=100
Defaulted container &quot;ex-aao-container&quot; out of: ex-aao-container, ex-aao-container-init (init)
Connection brokerURL = tcp://ex-aao-ss-0:61616
Producer ActiveMQQueue[TEST], thread=0 Started to calculate elapsed time ...

Producer ActiveMQQueue[TEST], thread=0 Produced: 100 messages
Producer ActiveMQQueue[TEST], thread=0 Elapsed time in second : 0 s
Producer ActiveMQQueue[TEST], thread=0 Elapsed time in milli second : 409 milli seconds
</code></pre><p>then send another 100 messages to broker <strong>ex-aao-ss-1</strong></p><pre><code class=language-$xslt>kubectl exec ex-aao-ss-1 -- amq-broker/bin/artemis producer --user x --password y --url tcp://ex-aao-ss-1:61616 --message-count=100
Defaulted container &quot;ex-aao-container&quot; out of: ex-aao-container, ex-aao-container-init (init)
Connection brokerURL = tcp://ex-aao-ss-1:61616
Producer ActiveMQQueue[TEST], thread=0 Started to calculate elapsed time ...

Producer ActiveMQQueue[TEST], thread=0 Produced: 100 messages
Producer ActiveMQQueue[TEST], thread=0 Elapsed time in second : 0 s
Producer ActiveMQQueue[TEST], thread=0 Elapsed time in milli second : 466 milli seconds
</code></pre><p>Now each of the 2 brokers has 100 messages. Modify the broker.yaml to scale down to one broker</p><p>broker.yaml</p><pre><code class=language-$xslt>apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: ex-aao
spec:
  deploymentPlan:
    size: 1
    image: placeholder
    persistenceEnabled: true
    messageMigration: true
</code></pre><p>and re-apply it:</p><pre><code class=language-$xslt>kubectl apply -f broker.yaml -n activemq-artemis-operator
</code></pre><p>The broker pods will be reduced to only one</p><pre><code class=language-$xslt>$ kubectl get pod
NAME                                                   READY   STATUS    RESTARTS   AGE
activemq-artemis-controller-manager-5ff459cd95-kn22m   1/1     Running   0          3h57m
ex-aao-ss-0                                            1/1     Running   0          39m
</code></pre><p>Now the messages on the broker pod <strong>ex-aao-ss-1</strong> should have been all migrated to pod <strong>ex-aao-ss-0</strong>.
Use the broker cli tool again to check:</p><pre><code class=language-$xslt>kubectl exec ex-aao-ss-0 -- amq-broker/bin/artemis queue stat --user x --password y --url tcp://ex-aao-ss-0:61616
Defaulted container &quot;ex-aao-container&quot; out of: ex-aao-container, ex-aao-container-init (init)
Connection brokerURL = tcp://ex-aao-ss-0:61616
|NAME                     |ADDRESS                  |CONSUMER_COUNT |MESSAGE_COUNT |MESSAGES_ADDED |DELIVERING_COUNT |MESSAGES_ACKED |SCHEDULED_COUNT |ROUTING_TYPE |
|$.artemis.internal.sf.my-cluster.941368e6-79c9-11ec-b4c8-0242ac11000b|$.artemis.internal.sf.my-cluster.941368e6-79c9-11ec-b4c8-0242ac11000b|0              |0             |0              |0                |0              |0               |MULTICAST    |
|DLQ                      |DLQ                      |0              |0             |0              |0                |0              |0               |ANYCAST      |
|ExpiryQueue              |ExpiryQueue              |0              |0             |0              |0                |0              |0               |ANYCAST      |
|TEST                     |TEST                     |0              |200           |200            |0                |0              |0               |ANYCAST      |
|activemq.management.91b87b03-0c70-4630-beb8-6a7919a4923a|activemq.management.91b87b03-0c70-4630-beb8-6a7919a4923a|1              |0             |0              |0                |0              |0               |MULTICAST    |
</code></pre><p>You can see the queue TEST has 200 messages now.</p><h2 id=undeploying-the-operator>Undeploying the operator <a href=#undeploying-the-operator class=anchor aria-hidden=true>#</a></h2><p>Run this command to undeploy the operator</p><pre><code class=language-$xslt>make OPERATOR_IMAGE_REPO=&lt;your repo&gt; OPERATOR_VERSION=&lt;tag&gt; undeploy
</code></pre><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=/docs/tutorials/deploybasicimage/><div class="card my-1"><div class="card-body py-2">&larr; Deploying the Basic Broker Image</div></div></a><a class=ms-auto href=/docs/tutorials/using_operator/><div class="card my-1"><div class="card-body py-2">Getting Started with the ArtemisCloud Operator &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-fluid><div class=container><div class=row><div class=col><a href=https://www.redhat.com/><img height=32px src=/images/Logo-Red_Hat-Sponsored_By-A-Standard-RGB.png alt="Red Hat"></a></div><div class=col-10><p style=font-size:12px>Apache, Apache ActiveMQ Artemis,Artemis and associated open source project names are trademarks of the <a href=https://www.apache.org/>Apache Software Foundation</a>.</p></div></div></div></div></footer><script src=/js/bootstrap.min.0a0106334435d4110713bfaff4acaf02533b0c56d44412a74e9518db07672ddb7e099a9c7517bc9cb529e2ddd4ae2e438b40b720288900d5e74fb6d8928d9097.js integrity="sha512-CgEGM0Q11BEHE7+v9KyvAlM7DFbURBKnTpUY2wdnLdt+CZqcdRe8nLUp4t3Uri5Di0C3ICiJANXnT7bYko2Qlw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.0d31f7af12feb83ee633b6351b023ee643ea3412376fbaa09c5a26d1a5ef999939f1ad379a5b12e1199a2c7d72ae1b23f633060a679628dcbfb0e72378cd20be.js integrity="sha512-DTH3rxL+uD7mM7Y1GwI+5kPqNBI3b7qgnFom0aXvmZk58a03mlsS4RmaLH1yrhsj9jMGCmeWKNy/sOcjeM0gvg==" crossorigin=anonymous defer></script>
<script src=/main.min.6afc4bf655f45ae3e63629ec95be8bd2e0e792084b5635a6fe70b169fa9d1491638b3a4e900ed59c2e017ca18768e5c392e110d0e1336509f49f7dc418d16eef.js integrity="sha512-avxL9lX0WuPmNinslb6L0uDnkghLVjWm/nCxafqdFJFjizpOkA7VnC4BfKGHaOXDkuEQ0OEzZQn0n33EGNFu7w==" crossorigin=anonymous defer></script>
<script src=/index.min.d0b87842cd742c19a17a386d3aef8ddbbed8a84c89eaeb2e9d4664db61476c21a92040ce5a50983828d982a23ae2f39a5eb7bd7bc221028df5b518a93b066cb8.js integrity="sha512-0Lh4Qs10LBmhejhtOu+N277YqEyJ6usunUZk22FHbCGpIEDOWlCYOCjZgqI64vOaXre9e8IhAo31tRipOwZsuA==" crossorigin=anonymous defer></script></body></html>